= Contexte de la mission
:imagesdir: assets/default/images

image::mi-briefing.png[]
//mi-fallout
[NOTE.speaker]
====
Nous allons maintenant entrer dans le cÅ“ur de la mission.
====

== 511 clusters Kubernetes
:imagesdir: assets/default

video::511-clusters.mp4[opts="autoplay,loop,muted,nocontrols",role=center,width=60%]

[NOTE.speaker]
====
Je pense que tout le monde connait ici Kubernetes: l'orchestrateur de containeurs.

Notre objectif : en dÃ©ployer 511.

Combien de temps va durer ce dÃ©ploiement ?

* Pour un cluster: minimum 5 minutes
* SÃ©quentiel : 2 jours
* ParallÃ©lisation

ğŸ› ï¸ Outils : Infrastructure As Code: automatisation | fiabilitÃ© | changement du nombre de clusters rapide

ğŸª‚ Mais on ne fonce pas tÃªte baissÃ©e : y aller palier par palier

====

== Plugin CNI
:imagesdir: assets/default/images
image::cnis.png[]

[NOTE.speaker]
====
CrÃ©er les clusters, câ€™est une chose. Mais les faire communiquer entre eux, câ€™est un tout autre niveau. Pour Ã§a, on entre dans un autre domaine : la couche rÃ©seau de Kubernetes. Et câ€™est lÃ  quâ€™interviennent les plugins CNI.

Objectif :

* Donner le rÃ©seau aux cluster kubernetes
* Ã‰tablir une communication entre containers sur des serveurs distincts.

Pas de plugin CNI par dÃ©faut

Exemples :

* ğŸ† Calico: le plus utilisÃ© historiquement
* ğŸ” Kube-router : minimaliste, BGP
* ğŸ§¬ Cilium : eBPF
====

== Kube-Proxy
image::kube-proxy.svg[]

[NOTE.speaker]
====
Les plugins CNI donnent un rÃ©seau aux pods.

Les pods sont Ã©phÃ©mÃ¨res. Leur adresse IP change. Or, les applications ont besoin dâ€™un point dâ€™entrÃ©e stable pour communiquer avec ces pods, peu importe oÃ¹ ils tournent.

ğŸ‘‰ Câ€™est le rÃ´le des Services : fournir une IP fixe vers un groupe de pods.

Ce nâ€™est pas kube-proxy qui route les paquets Ã  proprement parler. Son rÃ´le, câ€™est plutÃ´t de programmer le noyau Linux Ã  lâ€™aide de iptables pour que le trafic soit redirigÃ© vers les bons pods.

On a maintenant parlÃ© des principales briques rÃ©seau de Kubernetes. Parlons du plugin CNI que nous allons utiliser pour cette mission.
====

== Cilium

ğŸ‘ï¸ Hubble

ğŸ” CNP & chiffrement

ğŸ§¬ Service Mesh intÃ©grÃ©

ğŸï¸ Suppression de kube-proxy

image::cilium-paint-2.png[width=35%]

[NOTE.speaker]
====
Cilium ce n'est pas seulement un plugin CNI qui permet de donner le rÃ©seau Ã  Kubernetes, il a de nombreuses capacitÃ©s :

* ğŸ‘ï¸ ObservabilitÃ© : Hubble
* ğŸ” SÃ©curitÃ© : CNP & chiffrement
* ğŸ§¬ Service Mesh intÃ©grÃ©
* ğŸï¸ Suppression de kube-proxy

====

== Cilium Cluster Mesh
image::cilium-clustermesh.png[]

[NOTE.speaker]
====

Nous avons parlÃ© des fonctionnalitÃ©s les plus utilisÃ©s.
Mais pour cette mission en particulier, une autre fonctionnalitÃ© va jouer un rÃ´le central.
Celle qui va nous permettre de relier nos 511 clusters entre eux, comme sâ€™ils ne faisaient quâ€™un :
Cilium Cluster Mesh

ğŸš§ Conditions dâ€™activation :

* ğŸ”€ RÃ©seaux de pods disjoints
* ğŸŒ Noeuds routables entre clusters
* â›” Limite classique : 255 clusters
* ğŸ§ª NouveautÃ© 1.15 : 511 clusters possibles
====

== 2 clusters

image::2-cluster-1.png[]
[NOTE.speaker]
====

Mais avant dâ€™orchestrer 511 clusters, commenÃ§ons simple.

Regardons comment fonctionne **Cilium Cluster Mesh** avec seulement **2 clusters**.

Dans chaque cluster :

* Un **control plane** et deux **nÅ“uds workers**
* Des agents **Cilium** tournent sur chaque nÅ“ud et gÃ¨rent le rÃ©seau

Ce petit setup va nous permettre de comprendre les bases avant de passer Ã  lâ€™Ã©chelle.

Il y a deux phases pour la crÃ©ation d'un cluster mesh.
====

== Activation

image::2-cluster-2.svg[]

[NOTE.speaker]
====
Phase 1 : activation.

* pod cilium-clustermesh-api : une base de donnÃ©es etcd qui rÃ©cupÃ¨re les donnÃ©es utiles pour le cluster mesh
* svc pointe sur le pod cilium-clustermesh-api

* type de svc: Nodeport | loadbalancer | clusterip

====

== !

image::2-cluster-3.svg[]

[NOTE.speaker]
====
Phase 2 : connexion

Les agents cilium sont configurÃ©s pour rÃ©cupÃ¨rer les donnÃ©es de cilium-clustermesh-api de l'autre cluster.
====

== Relier 511 clusters

:imagesdir: assets/default
video::511-clusters-connected.mp4[opts="autoplay,loop,muted,nocontrols",role=center,width=60%]

[NOTE.speaker]
====
On a vu comment relier 2 clusters.

Mais maintenant... **changement dâ€™Ã©chelle** : **511 clusters** Ã  connecter entre eux.

ğŸ“ˆ Nombre total de communications Ã  Ã©tablir :

* ğŸ§® 511Ã—510/2 = 130 305 liens
* ğŸ•’ DurÃ©e de crÃ©ation dâ€™un lien : 15 secondes
* Temps total estimÃ© : â±ï¸ 542 heures (22 jours)

* ParallÃ©lisation ?
====

== VÃ©rification de la communication
:imagesdir: assets/default/images

image::cilium-paint-3.png[width=35%]

[NOTE.speaker]
====
Relier des clusters, câ€™est une chose.

Sâ€™assurer quâ€™ils **peuvent rÃ©ellement Ã©changer des paquets**, câ€™en est une autre.

Câ€™est une Ã©tape souvent nÃ©gligÃ©e.

Mais pour cette mission, **elle est incontournable**.
====

== DÃ©roulÃ© des opÃ©rations

ğŸ’° Budget serrÃ©

ğŸŒ«ï¸ Solution Cloud

[NOTE.speaker]
====
On a vu toutes les Ã©tapes techniques et les dÃ©fis Ã  venir.

Maintenant, parlons du dÃ©roulÃ© concret de la mission.

Le budget est serrÃ©, impossible dâ€™acheter 511 clusters Kubernetes.
On va donc les **louer** dans le cloud.

â³ Le challenge ? RÃ©aliser toute lâ€™opÃ©ration en **4 heures chrono**.
====

== DÃ©roulÃ© de chaque opÃ©ration

:imagesdir: assets/default/images

image::32-clusters-deroule.apng[width=50%]

[NOTE.speaker]
====
Comment va se dÃ©rouler chaque Ã©tape ?

* Provisionner un grand nombre de clusters
* Les connecter entre eux
* Tester que la communication fonctionne
* Tout va s'auto-dÃ©truire
====
